<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bundesliga Schedule 2024-2025</title>
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: "Nunito Sans";
        src: url("../fonts/NunitoSans-ExtraBold.ttf");
        font-display: swap;
        font-weight: bold;
      }
      body {
        font-family: "Nunito Sans", sans-serif;
      }
      .calendar-table th,
      .calendar-table td {
        vertical-align: top;
        font-size: 14px;
      }
      .match-details {
        margin-bottom: 5px;
        font-size: 12px;
      }
      footer {
        margin-top: 50px;
        padding: 20px;
        background-color: #f8f9fa;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img
        id="bundesliga-logo"
        src="https://www.bundesliga.com/assets/logo/bundesliga_neg.svg"
        alt="Bundesliga Logo"
      />
      <h1 class="my-4">2024-2025 Bundesliga Schedule</h1>

      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a
            class="nav-link active"
            id="full-schedule-tab"
            data-toggle="tab"
            href="#full-schedule"
            role="tab"
            aria-controls="full-schedule"
            aria-selected="true"
            >Full Schedule</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="calendar-view-tab"
            data-toggle="tab"
            href="#calendar-view"
            role="tab"
            aria-controls="calendar-view"
            aria-selected="false"
            >Calendar View</a
          >
        </li>
      </ul>

      <div class="tab-content" id="myTabContent">
        <div
          class="tab-pane fade show active"
          id="full-schedule"
          role="tabpanel"
          aria-labelledby="full-schedule-tab"
        >
          <div class="table-responsive">
            <table
              id="full-schedule-table"
              class="table table-striped table-bordered"
            >
              <thead class="thead-dark">
                <tr>
                  <th>Date</th>
                  <th>Matchday</th>
                  <th>Home Team</th>
                  <th>Away Team</th>
                  <th>Head-to-Head</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div
          class="tab-pane fade"
          id="calendar-view"
          role="tabpanel"
          aria-labelledby="calendar-view-tab"
        >
          <div class="table-responsive">
            <table
              id="bundesliga-schedule"
              class="table table-bordered calendar-table"
            >
              <thead class="thead-dark">
                <tr id="calendar-header"></tr>
              </thead>
              <tbody id="calendar-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <p>
          &copy; 2024 This site is not affiliated with the Bundesliga. All logos
          and names are property of their respective owners.
        </p>
      </div>
    </footer>

    <!-- Modal -->
    <div
      class="modal fade"
      id="h2hModal"
      tabindex="-1"
      aria-labelledby="h2hModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="h2hModalLabel">H2H STATS</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("combined_bundesliga_schedule.json")
          .then((response) => response.json())
          .then((data) => {
            const scheduleData = data.matches;

            const fullScheduleTbody = document.querySelector(
              "#full-schedule-table tbody"
            );
            scheduleData.forEach((match, index) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                        <td>${match.Date}</td>
                        <td>${match.Matchday}</td>
                        <td>${match["Home Team"]}</td>
                        <td>${match["Away Team"]}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="showH2HStats(${
                              match.Matchday
                            }, ${(index % 9) + 1})">H2H STATS</button>
                        </td>
                        `;
              fullScheduleTbody.appendChild(row);
            });

            const startDate = new Date("2024-08-23");
            const endDate = new Date("2025-05-24");
            const totalDays = Math.ceil(
              (endDate - startDate) / (1000 * 3600 * 24)
            );

            const headerRow = document.getElementById("calendar-header");
            const bodyRow = document.getElementById("calendar-body");

            for (let i = 0; i <= totalDays; i++) {
              const currentDate = new Date(startDate);
              currentDate.setDate(startDate.getDate() + i);
              const th = document.createElement("th");
              th.innerText = currentDate.toISOString().split("T")[0];
              headerRow.appendChild(th);
            }

            const tr = document.createElement("tr");
            for (let i = 0; i <= totalDays; i++) {
              const td = document.createElement("td");
              const currentDate = new Date(startDate);
              currentDate.setDate(startDate.getDate() + i);
              const currentDateString = currentDate.toISOString().split("T")[0];

              scheduleData.forEach((match) => {
                const matchDates = match.Date.split(" - ");
                matchDates.forEach((matchDate) => {
                  if (
                    new Date(matchDate).toISOString().split("T")[0] ===
                    currentDateString
                  ) {
                    const matchDetails = document.createElement("div");
                    matchDetails.classList.add("match-details");
                    matchDetails.innerHTML = `
                                    <strong>Matchday ${match.Matchday}</strong><br>
                                    ${match["Home Team"]} vs ${match["Away Team"]}
                                    `;
                    td.appendChild(matchDetails);
                  }
                });
              });

              tr.appendChild(td);
            }
            bodyRow.appendChild(tr);
          })
          .catch((error) => console.error("Error loading schedule:", error));
      });

      function showH2HStats(matchday, matchIndex) {
        const matchdayFolder = `Matchdays/Matchday_${matchday
          .toString()
          .padStart(2, "0")}`;
        const matchdayFile = `${matchdayFolder}/Day${matchday}-Match${matchIndex}.json`;

        console.log(`Fetching H2H stats from: ${matchdayFile}`);

        fetch(matchdayFile)
          .then((response) => response.json())
          .then((data) => {
            console.log("Data fetched successfully:", data);

            const modalBody = document.querySelector("#h2hModal .modal-body");
            modalBody.innerHTML = `
                        <h6>Matchday ${matchday}</h6>
                        ${data
                          .map(
                            (team) => `
                            <div><strong>${team.team}:</strong> ${team.wins}, ${team.draws}, ${team.losses}, ${team.goals}</div>
                        `
                          )
                          .join("")}
                    `;

            $("#h2hModal").modal("show");
          })
          .catch((error) => console.error("Error loading H2H stats:", error));
      }
    </script>
  </body>
</html>
